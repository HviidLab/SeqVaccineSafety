# ==============================================================================
# SeqVaccineSafety Configuration File
# ==============================================================================
# Centralized configuration for vaccine safety surveillance using SCRI designs
# with sequential monitoring methods.
# ==============================================================================

default:
  # ----------------------------------------------------------------------------
  # SIMULATION SETTINGS
  # ----------------------------------------------------------------------------
  simulation:
    # Simulation method selection
    method: "custom"
      # Options:
      #   - "custom": Transparent, educational simulation (default)
      #   - "sequential_design": Use SequentialDesign package for validation studies

    # Population parameters
    population_size: 20000
    random_seed: 12345
      # Set to NULL or comment out for non-reproducible random generation

    # Event rate parameters
    baseline_event_rate: 0.0002
      # Background adverse event rate per person-day
      # Example: 0.0002 = 2 events per 10,000 person-days

    true_relative_risk: 1.5
      # True underlying relative risk in the risk window
      # RR = 1.0 means no increased risk
      # RR = 1.5 means 50% increased risk
      # RR = 2.0 means doubled risk

    # Vaccination season parameters
    season:
      start_date: "2024-10-01"
      end_date: "2025-03-31"

    # Age distribution for population aged 65+
    age_distribution:
      age_65_74: 0.60
      age_75_84: 0.30
      age_85_plus: 0.10
      # Note: These must sum to 1.0

    # SequentialDesign package parameters (used when method="sequential_design")
    sequential_design:
      n_simulations: 1000
        # Number of simulations for validation studies
        # NOTE: 1000+ simulations needed for Type I error and power validation

      # Time parameters
      t0: 0
      tf: 2

      # Strata configuration
      n_strata: 2
      strata_ratio: [0.6, 0.4]
        # Proportion of population in each stratum (must sum to 1.0)

      event_rate_by_strata: [0.0002, 0.0003]
        # Event rates per person-day by stratum

      # Misclassification parameters
      sensitivity: 0.90
        # Diagnostic sensitivity (true positive rate)

      positive_predictive_value: 0.90
        # Positive predictive value in unexposed group

      # SCRI design parameters
      match_ratio: 1
        # Control-to-risk window ratio (1 = equal length windows)

      # Exposure accrual parameters
      exposure_rate: 20
      exposure_offset: 30

      # Sequential analysis integration
      max_sample_size: 200
        # Maximum number of cases before stopping

      alpha_parameter: 0.5
        # Rho parameter for power-type alpha spending

  # ----------------------------------------------------------------------------
  # SCRI DESIGN PARAMETERS
  # ----------------------------------------------------------------------------
  scri_design:
    # Risk window definition (post-vaccination period of elevated risk)
    risk_window:
      start_day: 1
      end_day: 28
        # Common choices: 7 (acute), 14 (short-term), 28 (medium-term), 42 (long-term)

    # Control window definition (baseline comparison period)
    control_window:
      start_day: 29
      end_day: 56
        # Best practice: Same length as risk window for balanced comparison

  # ----------------------------------------------------------------------------
  # SEQUENTIAL ANALYSIS PARAMETERS
  # ----------------------------------------------------------------------------
  sequential_analysis:
    # Type I error control
    overall_alpha: 0.05
      # Overall Type I error rate across all sequential looks
      # Standard: 0.05, Conservative: 0.01, Liberal: 0.10

    # Sequential monitoring schedule
    number_of_looks: 8
      # Total number of planned interim analyses
      # Typical range: 4-12 looks

    look_interval_days: 14
      # Days between sequential looks
      # Common choices: 7 (weekly), 14 (biweekly), 28 (monthly)

    minimum_cases_per_look: 20
      # Minimum number of cases required to perform analysis
      # Typical range: 10-50 cases

    # Early stopping rules
    stop_on_signal: true
      # If true, stop monitoring immediately when signal is detected

  # ----------------------------------------------------------------------------
  # DASHBOARD SETTINGS
  # ----------------------------------------------------------------------------
  dashboard:
    # Default values when dashboard opens
    defaults:
      alpha: 0.05
      number_of_looks: 8
      risk_window_start: 1
      risk_window_end: 28
      control_window_start: 29
      control_window_end: 56
      minimum_cases: 20

    # Slider ranges for user input
    ranges:
      alpha:
        min: 0.01
        max: 0.10
        step: 0.01

      number_of_looks:
        min: 4
        max: 12
        step: 1

      risk_window_days:
        min: 1
        max: 42
        step: 1

      control_window_days:
        min: 1
        max: 84
        step: 1

      minimum_cases:
        min: 10
        max: 50
        step: 5

    # Visual alert thresholds
    alert_thresholds:
      relative_risk:
        warning: 1.5
        critical: 2.0

      proportion_in_risk:
        warning: 0.60

  # ----------------------------------------------------------------------------
  # OUTPUT SETTINGS
  # ----------------------------------------------------------------------------
  output:
    # Directory for surveillance outputs
    directory: "surveillance_outputs"

    # Plot specifications
    plots:
      dpi: 120
        # Resolution in dots per inch (120 = standard, 300 = high quality)

      monitoring_plot:
        width: 10
        height: 8

      timeline_plot:
        width: 10
        height: 6

# ==============================================================================
# CONFIGURATION PROFILES
# ==============================================================================
# Alternative configurations for different scenarios.
# To use a profile: config::get(config = "profile_name")

conservative:
  simulation:
    population_size: 20000
    baseline_event_rate: 0.0002
    true_relative_risk: 1.5
    season:
      start_date: "2024-10-01"
      end_date: "2025-03-31"
  scri_design:
    risk_window:
      start_day: 1
      end_day: 28
    control_window:
      start_day: 29
      end_day: 56
  sequential_analysis:
    overall_alpha: 0.01      # More conservative
    number_of_looks: 4       # Fewer looks
    minimum_cases_per_look: 30

acute_events:
  simulation:
    population_size: 20000
    baseline_event_rate: 0.0002
    true_relative_risk: 2.0
    season:
      start_date: "2024-10-01"
      end_date: "2025-03-31"
  scri_design:
    risk_window:
      start_day: 1
      end_day: 7           # Focus on first week
    control_window:
      start_day: 8
      end_day: 14          # Match length
  sequential_analysis:
    overall_alpha: 0.05
    number_of_looks: 8
    look_interval_days: 7
    minimum_cases_per_look: 15
